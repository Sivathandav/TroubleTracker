# Implementation Plan

- [x] 1. Set up project structure and initialize repositories
  - Create root directory with separate folders for frontend and backend
  - Initialize React app in `client` folder using create-react-app
  - Initialize Node.js project in `server` folder with Express
  - Set up Git repository with proper .gitignore files
  - Create README.md with project setup instructions
  - _Requirements: 1.1, 2.1, 6.1_

- [x] 2. Configure backend environment and database connection
  - [x] 2.1 Install backend dependencies (express, mongoose, bcryptjs, jsonwebtoken, dotenv, cors, express-validator)
    - Install all required npm packages for backend
    - _Requirements: 3.1, 3.2_
  - [x] 2.2 Create environment configuration file
    - Set up .env file with MongoDB URI, JWT secret, port, and environment variables
    - Create .env.example template
    - _Requirements: 3.1, 6.2_
  - [x] 2.3 Implement MongoDB connection module
    - Create database connection utility in `config/db.js`
    - Add connection error handling and retry logic
    - _Requirements: 3.1_
  - [x] 2.4 Set up Express server with middleware
    - Configure CORS, JSON parsing, and basic error handling
    - Create server.js entry point
    - _Requirements: 2.1, 6.1_

- [x] 3. Create User model and database schema
  - [x] 3.1 Define Mongoose User schema
    - Create User model with name, email, password, role, and createdAt fields
    - Add email uniqueness constraint and immutability
    - Add validation rules (min length, required fields, email format)
    - _Requirements: 3.1, 3.2, 5.1, 5.2_
  - [x] 3.2 Implement password hashing pre-save hook
    - Add Mongoose pre-save middleware to hash passwords with bcrypt
    - Only hash if password is modified
    - _Requirements: 3.1, 3.2, 4.1_
  - [x] 3.3 Add password comparison method to User model
    - Create instance method to compare plain text password with hashed password
    - _Requirements: 2.2, 3.3_

- [x] 4. Implement authentication utilities and middleware
  - [x] 4.1 Create JWT token generation utility
    - Write function to generate JWT with user payload (id, email, role)
    - Set token expiration to 7 days
    - _Requirements: 2.3, 2.5, 6.5_
  - [x] 4.2 Implement authentication middleware
    - Create middleware to verify JWT tokens from Authorization header
    - Extract and attach user data to request object
    - Handle invalid/expired tokens with 401 response
    - _Requirements: 6.1, 6.2, 6.3_

- [x] 5. Build authentication API endpoints
  - [x] 5.1 Create auth routes file
    - Set up Express router for authentication endpoints
    - Define routes: POST /signup, POST /login, GET /verify, GET /check-admin
    - _Requirements: 1.1, 2.1, 6.1_
  - [x] 5.2 Implement signup controller
    - Check if admin already exists in database
    - Validate input data (name, email, password)
    - Check for duplicate email
    - Create admin user with hashed password
    - Return success response without token
    - Handle errors: "Email already exists", "Admin account already exists"
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2_
  - [x] 5.3 Implement login controller
    - Find user by email
    - Verify password using bcrypt comparison
    - Generate JWT token on successful authentication
    - Return token and user data (excluding password)
    - Handle error: "Invalid credentials" for wrong email or password
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 3.3_
  - [x] 5.4 Implement token verification endpoint
    - Use auth middleware to verify token
    - Return authenticated user data
    - Handle invalid/expired tokens
    - _Requirements: 6.2, 6.3_
  - [x] 5.5 Implement check-admin endpoint
    - Query database for user with role "admin"
    - Return boolean indicating if admin exists
    - _Requirements: 1.4_
  - [ ]* 5.6 Add input validation middleware
    - Use express-validator for request validation
    - Validate email format, password length, required fields
    - Return 400 errors for validation failures
    - _Requirements: 1.5, 2.4_

- [x] 6. Set up frontend React application structure
  - [x] 6.1 Install frontend dependencies
    - Install react-router-dom for routing
    - _Requirements: 2.3, 6.1_
  - [x] 6.2 Configure React Router
    - Set up BrowserRouter with routes for /login, /signup, /dashboard
    - _Requirements: 2.3, 6.1_
  - [x] 6.3 Create folder structure
    - Create folders: components/auth, components/common, context, services, utils
    - _Requirements: 1.1, 2.1_
  - [x] 6.4 Set up environment variables
    - Create .env file with REACT_APP_API_URL
    - _Requirements: 2.1, 2.3_

- [x] 7. Implement authentication context and state management
  - [x] 7.1 Create AuthContext provider
    - Set up React Context for global auth state
    - Manage user, token, isAuthenticated, and loading states
    - _Requirements: 2.3, 2.5, 6.1_
  - [x] 7.2 Implement login function in context
    - Call login API endpoint
    - Store token in localStorage
    - Update context state with user data
    - _Requirements: 2.3, 2.5_
  - [x] 7.3 Implement logout function in context
    - Clear token from localStorage
    - Reset context state
    - _Requirements: 4.2, 4.3_
  - [x] 7.4 Add token verification on app load
    - Check for token in localStorage on mount
    - Verify token with backend
    - Restore user session if valid
    - _Requirements: 6.2_

- [x] 8. Create authentication service for API calls
  - [x] 8.1 Implement auth API service
    - Create functions: signup(), login(), verifyToken(), checkAdminExists()
    - Use fetch API with proper headers and error handling
    - _Requirements: 1.1, 2.1, 6.4_
  - [x] 8.2 Add request interceptor for auth token
    - Attach Authorization header with JWT token to protected requests
    - _Requirements: 6.4_

- [x] 9. Build Login page component
  - [x] 9.1 Create Login component structure
    - Set up component with form state (email, password, error, loading)
    - _Requirements: 2.1_
  - [x] 9.2 Implement login form UI matching Figma design
    - Create email and password input fields
    - Add login button
    - Add link to signup page (conditional)
    - Extract colors, typography, and spacing from Figma
    - Use CSS Modules for styling
    - _Requirements: 2.1_
  - [x] 9.3 Add form validation
    - Validate email format and required fields
    - Display inline error messages
    - _Requirements: 2.1, 2.4_
  - [x] 9.4 Implement login submission logic
    - Call login function from AuthContext
    - Handle loading state
    - Display API error messages
    - Redirect to dashboard on success
    - _Requirements: 2.2, 2.3, 2.4, 2.5_
  - [x] 9.5 Style error states and loading indicators
    - Match Figma design for error messages
    - Add loading spinner or disabled state
    - _Requirements: 2.4_

- [x] 10. Build Signup page component
  - [x] 10.1 Create Signup component structure
    - Set up component with form state (name, email, password, error, loading)
    - _Requirements: 1.1_
  - [x] 10.2 Implement signup form UI matching Figma design
    - Create name, email, and password input fields
    - Add signup button
    - Add link to login page
    - Use CSS Modules for styling matching Figma
    - _Requirements: 1.1_
  - [x] 10.3 Add admin existence check on mount
    - Call checkAdminExists API on component mount
    - Redirect to login if admin already exists
    - _Requirements: 1.4_
  - [x] 10.4 Add form validation
    - Validate name, email format, password length, and required fields
    - Display inline error messages
    - _Requirements: 1.5_
  - [x] 10.5 Implement signup submission logic
    - Call signup API endpoint
    - Handle loading state
    - Display API error messages ("Email already exists", "Admin account already exists")
    - Redirect to login page on success
    - _Requirements: 1.2, 1.3, 1.5_

- [x] 11. Implement ProtectedRoute component
  - [x] 11.1 Create ProtectedRoute wrapper component
    - Check authentication status from AuthContext
    - Redirect to login if not authenticated
    - Render children if authenticated
    - _Requirements: 6.1, 6.2_
  - [x] 11.2 Add token verification logic
    - Verify token validity on mount
    - Handle expired/invalid tokens
    - _Requirements: 6.2, 6.3_
  - [x] 11.3 Wrap protected routes with ProtectedRoute
    - Apply to dashboard and other protected routes
    - _Requirements: 6.1_

- [ ] 12. Implement password change functionality
  - [ ] 12.1 Create password change API endpoint
    - Add PUT /api/auth/change-password route
    - Verify current password
    - Hash and update new password
    - _Requirements: 4.1, 4.2_
  - [ ] 12.2 Implement automatic logout on password change
    - Clear authentication token after password update
    - Terminate current session
    - _Requirements: 4.2, 4.3_
  - [ ] 12.3 Add frontend password change form (in user profile)
    - Create form with current password and new password fields
    - Call password change API
    - Handle automatic logout and redirect to login
    - _Requirements: 4.2, 4.3, 4.4_

- [ ] 13. Add comprehensive error handling
  - [ ] 13.1 Implement frontend error handling
    - Display validation errors inline
    - Show API error messages
    - Handle network errors
    - _Requirements: 1.5, 2.4_
  - [ ] 13.2 Implement backend error handling middleware
    - Create global error handler
    - Format error responses consistently
    - Log errors for debugging
    - _Requirements: 1.5, 2.4_
  - [ ] 13.3 Handle edge cases
    - Duplicate email signup
    - Invalid credentials login
    - Expired token access
    - Missing authorization header
    - _Requirements: 1.5, 2.4, 6.3_

- [ ] 14. Test authentication flows
  - [ ] 14.1 Test signup flow
    - First admin signup success
    - Duplicate email error
    - Admin already exists redirect
    - Form validation errors
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_
  - [ ] 14.2 Test login flow
    - Successful login with valid credentials
    - Invalid credentials error
    - Token storage and session creation
    - Dashboard redirect
    - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_
  - [ ] 14.3 Test protected route access
    - Unauthenticated access redirect
    - Authenticated access success
    - Invalid token handling
    - _Requirements: 6.1, 6.2, 6.3_
  - [ ] 14.4 Test password change flow
    - Password update success
    - Automatic logout
    - Login with new password
    - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 15. Finalize UI to match Figma design exactly
  - [ ] 15.1 Extract all design tokens from Figma
    - Colors (primary, secondary, error, text, background)
    - Typography (font families, sizes, weights, line heights)
    - Spacing values (margins, padding)
    - Border radius, shadows, transitions
    - _Requirements: 1.1, 2.1_
  - [ ] 15.2 Implement responsive design
    - Test on mobile, tablet, and desktop breakpoints
    - Ensure forms are usable on all screen sizes
    - _Requirements: 1.1, 2.1_
  - [ ] 15.3 Add form field states
    - Default, focus, error, and disabled states
    - Match Figma specifications exactly
    - _Requirements: 1.1, 2.1_
  - [ ] 15.4 Polish interactions and animations
    - Button hover and active states
    - Loading indicators
    - Smooth transitions
    - _Requirements: 1.1, 2.1_

- [ ] 16. Prepare for deployment
  - [ ] 16.1 Configure backend for Render deployment
    - Set up build command and start script
    - Configure environment variables
    - Set up MongoDB Atlas connection
    - _Requirements: 2.1, 3.1_
  - [ ] 16.2 Configure frontend for production
    - Build optimized production bundle
    - Set production API URL
    - _Requirements: 2.1_
  - [ ] 16.3 Test production builds locally
    - Run production backend
    - Serve production frontend
    - Test all authentication flows
    - _Requirements: 1.1, 2.1, 6.1_
